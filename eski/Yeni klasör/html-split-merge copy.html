<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Split/Merge Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: clamp(1.5em, 5vw, 2em);
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: clamp(0.8em, 3vw, 0.9em);
        }

        .mode-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-card {
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .mode-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .mode-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
        }

        .mode-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .mode-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .mode-desc {
            color: #666;
            font-size: 0.9em;
        }

        .file-section {
            display: none;
            margin-top: 30px;
        }

        .file-section.active {
            display: block;
        }

        .file-input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        .file-input-label {
            display: block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        input[type="file"] {
            display: none;
        }

        .split-options {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .split-options label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .split-options input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        .split-options input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .process-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .process-btn:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .process-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result-box {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .result-box.success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            display: block;
        }

        .result-box.error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
            display: block;
        }

        .result-box.info {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            color: #0c5460;
            display: block;
        }

        .result-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .result-list {
            margin-top: 10px;
            padding-left: 20px;
        }

        .result-list li {
            margin: 5px 0;
            word-break: break-word;
        }

        .back-btn {
            margin-top: 20px;
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            width: 100%;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .file-name {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4f8;
            border-radius: 5px;
            font-size: 0.9em;
            color: #333;
            word-break: break-word;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .mode-card {
                padding: 20px;
            }

            .mode-icon {
                font-size: 2.5em;
            }

            h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß HTML Split/Merge Tool</h1>
        <p class="subtitle">HTML dosyalarƒ±nƒ± par√ßalara ayƒ±rƒ±n veya birle≈ütirin</p>

        <div id="modeSelection" class="mode-selection">
            <div class="mode-card" onclick="selectMode('split')">
                <div class="mode-icon">‚úÇÔ∏è</div>
                <div class="mode-title">Split</div>
                <div class="mode-desc">HTML'i CSS ve JS dosyalarƒ±na ayƒ±rƒ±p ZIP olarak indir</div>
            </div>
            <div class="mode-card" onclick="selectMode('merge')">
                <div class="mode-icon">üîó</div>
                <div class="mode-title">Merge</div>
                <div class="mode-desc">CSS ve JS dosyalarƒ±nƒ± tek HTML'de birle≈ütir</div>
            </div>
        </div>

        <div id="splitSection" class="file-section">
            <div class="file-input-wrapper">
                <label for="splitHtmlFile" class="file-input-label">
                    üìÑ HTML Dosyasƒ± Se√ß
                </label>
                <input type="file" id="splitHtmlFile" accept=".html,.htm" onchange="handleSplitFileSelect(event)">
                <div id="splitFileName" class="file-name" style="display:none;"></div>
            </div>

            <div class="split-options">
                <label for="jsPartCount">JS Ka√ß Par√ßaya Ayrƒ±lsƒ±n?</label>
                <input type="number" id="jsPartCount" min="1" max="50" value="5">
            </div>

            <button class="process-btn" onclick="processSplit()" disabled id="splitBtn">
                ƒ∞≈ülemi Ba≈ülat
            </button>

            <button class="back-btn" onclick="resetMode()">‚Üê Geri D√∂n</button>
        </div>

        <div id="mergeSection" class="file-section">
            <div class="file-input-wrapper">
                <label for="mergeHtmlFile" class="file-input-label">
                    üìÑ HTML Dosyasƒ± Se√ß
                </label>
                <input type="file" id="mergeHtmlFile" accept=".html,.htm" onchange="handleMergeFileSelect(event)">
                <div id="mergeFileName" class="file-name" style="display:none;"></div>
            </div>

            <button class="process-btn" onclick="processMerge()" disabled id="mergeBtn">
                ƒ∞≈ülemi Ba≈ülat
            </button>

            <button class="back-btn" onclick="resetMode()">‚Üê Geri D√∂n</button>
        </div>

        <div id="resultBox" class="result-box"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        let currentMode = null;
        let selectedFile = null;

        function selectMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.mode-card').classList.add('active');
            
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('resultBox').style.display = 'none';
            
            if (mode === 'split') {
                document.getElementById('splitSection').classList.add('active');
            } else {
                document.getElementById('mergeSection').classList.add('active');
            }
        }

        function resetMode() {
            currentMode = null;
            selectedFile = null;
            document.getElementById('modeSelection').style.display = 'grid';
            document.getElementById('splitSection').classList.remove('active');
            document.getElementById('mergeSection').classList.remove('active');
            document.getElementById('resultBox').style.display = 'none';
            document.getElementById('splitHtmlFile').value = '';
            document.getElementById('mergeHtmlFile').value = '';
            document.getElementById('splitFileName').style.display = 'none';
            document.getElementById('mergeFileName').style.display = 'none';
            document.getElementById('splitBtn').disabled = true;
            document.getElementById('mergeBtn').disabled = true;
        }

        function handleSplitFileSelect(event) {
            selectedFile = event.target.files[0];
            if (selectedFile) {
                document.getElementById('splitFileName').textContent = 'Se√ßilen: ' + selectedFile.name;
                document.getElementById('splitFileName').style.display = 'block';
                document.getElementById('splitBtn').disabled = false;
            }
        }

        function handleMergeFileSelect(event) {
            selectedFile = event.target.files[0];
            if (selectedFile) {
                document.getElementById('mergeFileName').textContent = 'Se√ßilen: ' + selectedFile.name;
                document.getElementById('mergeFileName').style.display = 'block';
                document.getElementById('mergeBtn').disabled = false;
            }
        }

        function showResult(type, title, message, list) {
            list = list || [];
            const resultBox = document.getElementById('resultBox');
            resultBox.className = 'result-box ' + type;
            
            let html = '<div class="result-title">' + title + '</div><p>' + message + '</p>';
            if (list.length > 0) {
                html += '<ul class="result-list">';
                list.forEach(function(item) {
                    html += '<li>' + item + '</li>';
                });
                html += '</ul>';
            }
            
            resultBox.innerHTML = html;
        }

        async function processSplit() {
            if (!selectedFile) return;
            
            const jsCount = parseInt(document.getElementById('jsPartCount').value);
            if (jsCount < 1 || jsCount > 50) {
                showResult('error', '‚ùå Hata', 'JS par√ßa sayƒ±sƒ± 1-50 arasƒ±nda olmalƒ±dƒ±r.');
                return;
            }

            document.getElementById('splitBtn').disabled = true;
            showResult('info', '‚è≥ ƒ∞≈üleniyor...', 'HTML dosyasƒ± i≈üleniyor, l√ºtfen bekleyin...');

            try {
                const htmlText = await selectedFile.text();
                const fileName = selectedFile.name.replace(/\.(html|htm)$/i, '');
                
                const result1 = extractStyles(htmlText);
                const htmlWithoutStyles = result1.html;
                const css = result1.css;
                
                const result2 = extractBodyScripts(htmlWithoutStyles);
                const finalHtml = result2.html;
                const js = result2.js;
                
                const jsUnits = splitJsIntoUnits(js);
                const jsFiles = packUnitsIntoFiles(jsUnits, jsCount);
                const htmlWithLink = ensureStylesLinkInHead(finalHtml);
                
                const jsFilenames = jsFiles.map(function(_, i) {
                    return 'js' + (i + 1) + '.js';
                });
                const loaderScript = buildLoaderScript(jsFilenames);
                const htmlFinal = addLoaderToBody(htmlWithLink, loaderScript);
                
                const zip = new JSZip();
                zip.file(fileName + '.html', htmlFinal);
                zip.file('styles.css', css || '');
                
                const jsFolder = zip.folder('js');
                jsFiles.forEach(function(content, i) {
                    jsFolder.file('js' + (i + 1) + '.js', content || '');
                });
                
                const zipBlob = await zip.generateAsync({ type: 'blob' });
                downloadBlob(zipBlob, fileName + '_split.zip');
                
                showResult('success', '‚úÖ Ba≈üarƒ±lƒ±!', 'Dosyalar ba≈üarƒ±yla olu≈üturuldu ve indirildi.', [
                    fileName + '.html (g√ºncellendi)',
                    'styles.css',
                    'js/ klas√∂r√ºnde ' + jsCount + ' dosya'
                ]);
            } catch (error) {
                showResult('error', '‚ùå Hata', 'ƒ∞≈ülem sƒ±rasƒ±nda hata olu≈ütu: ' + error.message);
            }
            
            document.getElementById('splitBtn').disabled = false;
        }

        function extractStyles(html) {
            const styleRegex = /(<style\b[^>]*>)(.*?)<\/style>/gis;
            const cssParts = [];
            
            const newHtml = html.replace(styleRegex, function(match, openTag, content) {
                if (content.trim()) {
                    cssParts.push(content.trim());
                }
                return openTag + '<' + '/style>';
            });
            
            return {
                html: newHtml,
                css: cssParts.join('\n\n')
            };
        }

        function extractBodyScripts(html) {
            const bodyRegex = /(<body\b[^>]*>)(.*?)(<\/body>)/is;
            const bodyMatch = html.match(bodyRegex);
            
            if (!bodyMatch) {
                const result = extractScriptsFromText(html);
                return { html: result.html, js: result.js };
            }
            
            const bodyOpen = bodyMatch[1];
            const bodyContent = bodyMatch[2];
            const bodyClose = bodyMatch[3];
            
            const result = extractScriptsFromText(bodyContent);
            const newBodyContent = result.html;
            const js = result.js;
            
            const newBody = bodyOpen + newBodyContent + bodyClose;
            const finalHtml = html.substring(0, bodyMatch.index) + newBody + html.substring(bodyMatch.index + bodyMatch[0].length);
            
            return { html: finalHtml, js: js };
        }

        function extractScriptsFromText(text) {
            const scriptRegex = /(<script\b[^>]*>)(.*?)<\/script>/gis;
            const jsParts = [];
            
            const newText = text.replace(scriptRegex, function(match, openTag, content) {
                if (content.trim()) {
                    jsParts.push(content.trim());
                }
                return openTag + '<' + '/script>';
            });
            
            return {
                html: newText,
                js: jsParts.join('\n\n')
            };
        }

        function splitJsIntoUnits(js) {
            if (!js.trim()) return [];
            
            const lines = js.split('\n');
            const units = [];
            let current = [];
            let braceDepth = 0;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                current.push(line);
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '{') braceDepth++;
                    if (char === '}') braceDepth = Math.max(0, braceDepth - 1);
                }
                
                const trimmed = line.trim();
                if (braceDepth === 0 && (trimmed.endsWith(';') || trimmed.endsWith('}'))) {
                    units.push(current.join('\n') + '\n');
                    current = [];
                }
            }
            
            if (current.length > 0) {
                units.push(current.join('\n') + '\n');
            }
            
            const merged = [];
            let buffer = '';
            for (let i = 0; i < units.length; i++) {
                const unit = units[i];
                if (unit.trim().length < 30) {
                    buffer += unit;
                } else {
                    if (buffer) {
                        merged.push(buffer);
                        buffer = '';
                    }
                    merged.push(unit);
                }
            }
            if (buffer) merged.push(buffer);
            
            return merged.filter(function(u) {
                return u.trim();
            });
        }

        function packUnitsIntoFiles(units, n) {
            if (n <= 1) return [units.join('')];
            if (units.length === 0) {
                const arr = [];
                for (let i = 0; i < n; i++) arr.push('');
                return arr;
            }
            
            const total = units.reduce(function(sum, u) {
                return sum + u.length;
            }, 0);
            const target = Math.max(1, Math.floor(total / n));
            
            const files = [];
            let current = '';
            
            for (let i = 0; i < units.length; i++) {
                const unit = units[i];
                if (files.length < n - 1 && current && (current.length + unit.length > target)) {
                    files.push(current);
                    current = '';
                }
                current += unit;
            }
            files.push(current);
            
            while (files.length < n) files.push('');
            if (files.length > n) {
                const tail = files.slice(n - 1).join('');
                return files.slice(0, n - 1).concat([tail]);
            }
            
            return files;
        }

        function buildLoaderScript(jsFilenames) {
            let script = '<script>\n';
            script += 'const v = new Date().getTime();\n';
            for (let i = 0; i < jsFilenames.length; i++) {
                const fn = jsFilenames[i];
                script += 'document.write(\'<script src="js/' + fn + '?v=\' + v + \'"><\\/script>\');\n';
            }
            script += '<' + '/script>';
            return script;
        }

        function ensureStylesLinkInHead(html) {
            const linkTag = '<link rel="stylesheet" href="styles.css">';
            
            if (/<link\b[^>]*href=["']styles\.css["']/i.test(html)) {
                return html;
            }
            
            const headRegex = /(<head\b[^>]*>)(.*?)(<\/head>)/is;
            const headMatch = html.match(headRegex);
            
            if (headMatch) {
                const newHead = headMatch[1] + headMatch[2].trimEnd() + '\n' + linkTag + '\n' + headMatch[3];
                return html.substring(0, headMatch.index) + newHead + html.substring(headMatch.index + headMatch[0].length);
            }
            
            const htmlCloseMatch = html.match(/<\/html\s*>/i);
            if (htmlCloseMatch) {
                return html.substring(0, htmlCloseMatch.index) + '\n' + linkTag + '\n' + html.substring(htmlCloseMatch.index);
            }
            
            return linkTag + '\n' + html;
        }

        function addLoaderToBody(html, loader) {
            const bodyRegex = /(<body\b[^>]*>)(.*?)(<\/body>)/is;
            const bodyMatch = html.match(bodyRegex);
            
            if (bodyMatch) {
                const bodyContent = bodyMatch[2];
                if (bodyContent.indexOf(loader.trim()) === -1) {
                    const newBody = bodyMatch[1] + bodyContent.trimEnd() + '\n\n' + loader + '\n' + bodyMatch[3];
                    return html.substring(0, bodyMatch.index) + newBody + html.substring(bodyMatch.index + bodyMatch[0].length);
                }
            } else {
                return html.trimEnd() + '\n\n' + loader + '\n';
            }
            
            return html;
        }

        async function processMerge() {
            if (!selectedFile) return;
            
            document.getElementById('mergeBtn').disabled = true;
            showResult('info', '‚è≥ ƒ∞≈üleniyor...', 'HTML dosyasƒ± birle≈ütiriliyor, l√ºtfen bekleyin...');

            try {
                const htmlText = await selectedFile.text();
                const fileName = selectedFile.name.replace(/\.(html|htm)$/i, '');
                
                let mergedHtml = htmlText;
                const processedFiles = [];
                const errors = [];
                
                const linkRegex = /<link\b[^>]*rel=["']stylesheet["'][^>]*href=["']([^"']+)["'][^>]*>/gi;
                let match;
                const cssPromises = [];
                const cssReplacements = [];
                
                while ((match = linkRegex.exec(htmlText)) !== null) {
                    const href = match[1];
                    if (isRelativePath(href)) {
                        cssPromises.push(
                            fetchRelativeFile(href)
                                .then(function(content) {
                                    cssReplacements.push({
                                        original: match[0],
                                        replacement: '<!-- ' + match[0] + ' -->\n<style>\n' + content + '\n<' + '/style>'
                                    });
                                    processedFiles.push(href);
                                })
                                .catch(function(err) {
                                    errors.push('CSS bulunamadƒ±: ' + href);
                                })
                        );
                    }
                }
                
                await Promise.all(cssPromises);
                
                for (let i = 0; i < cssReplacements.length; i++) {
                    const repl = cssReplacements[i];
                    mergedHtml = mergedHtml.replace(repl.original, repl.replacement);
                }
                
                const scriptRegex = /<script\b[^>]*src=["']([^"']+)["'][^>]*><\/script>/gi;
                const jsPromises = [];
                const jsReplacements = [];
                
                scriptRegex.lastIndex = 0;
                
                while ((match = scriptRegex.exec(htmlText)) !== null) {
                    const src = match[1];
                    if (isRelativePath(src)) {
                        jsPromises.push(
                            fetchRelativeFile(src)
                                .then(function(content) {
                                    jsReplacements.push({
                                        original: match[0],
                                        replacement: '<!-- ' + match[0] + ' -->\n<script>\n' + content + '\n<' + '/script>'
                                    });
                                    processedFiles.push(src);
                                })
                                .catch(function(err) {
                                    errors.push('JS bulunamadƒ±: ' + src);
                                })
                        );
                    }
                }
                
                await Promise.all(jsPromises);
                
                for (let i = 0; i < jsReplacements.length; i++) {
                    const repl = jsReplacements[i];
                    mergedHtml = mergedHtml.replace(repl.original, repl.replacement);
                }
                
                const blob = new Blob([mergedHtml], { type: 'text/html;charset=utf-8' });
                downloadBlob(blob, fileName + '_merged.html');
                
                const resultList = [processedFiles.length + ' dosya birle≈ütirildi'].concat(processedFiles).concat(errors);
                
                showResult(
                    errors.length > 0 ? 'info' : 'success',
                    errors.length > 0 ? '‚ö†Ô∏è Kƒ±smen Ba≈üarƒ±lƒ±' : '‚úÖ Ba≈üarƒ±lƒ±!',
                    errors.length > 0 
                        ? 'Bazƒ± dosyalar bulunamadƒ± ancak i≈ülem tamamlandƒ±.'
                        : 'T√ºm dosyalar ba≈üarƒ±yla birle≈ütirildi.',
                    resultList
                );
            } catch (error) {
                showResult('error', '‚ùå Hata', 'ƒ∞≈ülem sƒ±rasƒ±nda hata olu≈ütu: ' + error.message);
            }
            
            document.getElementById('mergeBtn').disabled = false;
        }

        function isRelativePath(path) {
            return !path.startsWith('http://') && 
                   !path.startsWith('https://') && 
                   !path.startsWith('//') &&
                   !path.startsWith('data:');
        }

        async function fetchRelativeFile(path) {
            return new Promise(function(resolve, reject) {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '*/*';
                
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:9999;';
                modal.innerHTML = '<div style="background:white;padding:30px;border-radius:15px;max-width:90%;max-width:500px;text-align:center;"><h3 style="margin-bottom:20px;">üìÅ Dosya Se√ßin</h3><p style="margin-bottom:20px;color:#666;word-break:break-word;">' + path + '</p><button id="selectFileBtn" style="background:#667eea;color:white;border:none;padding:12px 30px;border-radius:8px;cursor:pointer;font-size:1em;margin-right:10px;margin-bottom:10px;">Dosya Se√ß</button><button id="skipFileBtn" style="background:#6c757d;color:white;border:none;padding:12px 30px;border-radius:8px;cursor:pointer;font-size:1em;">Atla</button></div>';
                
                document.body.appendChild(modal);
                
                document.getElementById('selectFileBtn').onclick = function() {
                    fileInput.click();
                };
                
                document.getElementById('skipFileBtn').onclick = function() {
                    document.body.removeChild(modal);
                    reject(new Error('Dosya atlandƒ±'));
                };
                
                fileInput.onchange = async function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        try {
                            const content = await file.text();
                            document.body.removeChild(modal);
                            resolve(content);
                        } catch (err) {
                            document.body.removeChild(modal);
                            reject(err);
                        }
                    }
                };
            });
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>