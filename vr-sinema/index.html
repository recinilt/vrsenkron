<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Sinema - Sosyal Ä°zleme - Full Edition</title>
    
    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <!-- A-Frame Components -->
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-gui@0.3.4/dist/aframe-gui.min.js"></script>
    
    <!-- HLS.js for .ts video support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <link rel="stylesheet" href="styles.css">
    
</head>
<body>

<!-- 2D UI Overlay -->
<div id="ui-overlay">
    <div class="ui-container">
        <h1>ğŸ¬ VR Sosyal Sinema</h1>
        
        <!-- Nickname GiriÅŸi -->
        <div id="nickname-screen">
            <h2>ğŸ‘¤ HoÅŸ Geldiniz</h2>
            <p>BaÅŸlamadan Ã¶nce bir takma ad seÃ§in:</p>
            <input type="text" id="nickname-input" placeholder="Takma adÄ±nÄ±z (Ã¶rn: Ahmet123)" maxlength="20" />
            <div class="info-box">
                ğŸ’¡ Bu isim diÄŸer kullanÄ±cÄ±lar tarafÄ±ndan gÃ¶rÃ¼lecektir.
            </div>
            <button onclick="setNickname()">âœ… Devam Et</button>
        </div>
        
        <!-- Ana MenÃ¼ -->
        <div id="main-menu" style="display: none;">
            <h2>HoÅŸ Geldiniz, <span id="welcome-nickname"></span></h2>
            <button onclick="showCreateRoom()">â• Yeni Oda OluÅŸtur</button>
            <button onclick="showRoomList()" class="secondary">ğŸšª Odalara GÃ¶zat</button>
        </div>
        
        <!-- Oda OluÅŸturma -->
        <div id="create-room" style="display: none;">
            <h2>Yeni Oda OluÅŸtur</h2>
            <input type="text" id="room-name-input" placeholder="Oda AdÄ± (Ã¶rn: Film Gecesi)" />
            
            <div class="info-box">
                ğŸ’¡ <strong>Video linki opsiyoneldir!</strong><br>
                Åimdi boÅŸ bÄ±rakÄ±p sonradan da ekleyebilirsiniz.
            </div>
            
            <div class="info-box">
                ğŸ’¡ <strong>Desteklenen Video Servisleri:</strong><br>
                ğŸ”¹ <strong>YouTube</strong> - youtube.com, youtu.be<br>
                ğŸ”¹ <strong>Google Drive</strong> - drive.google.com (public link)<br>
                ğŸ”¹ <strong>Catbox.moe</strong> - Ãœcretsiz, 200 MB<br>
                ğŸ”¹ <strong>Bunny CDN</strong> - Profesyonel<br>
                ğŸ”¹ <strong>HLS Streams</strong> - .m3u8, .ts dosyalarÄ±<br>
                ğŸ”¹ <strong>Direkt link</strong> - .mp4, .webm, .mov, .ogg
            </div>
            
            <textarea id="video-url-input" placeholder="Video URL (opsiyonel - sonradan ekleyebilirsiniz)

Ã–rnekler:
https://www.youtube.com/watch?v=VIDEO_ID
https://youtu.be/VIDEO_ID
https://drive.google.com/file/d/FILE_ID/view
https://files.catbox.moe/abc123.mp4
https://yourzone.b-cdn.net/video.mp4
https://example.com/stream.m3u8"></textarea>
            
            <div class="checkbox-container">
                <input type="checkbox" id="private-room-check" />
                <label for="private-room-check">ğŸ”’ Ã–zel Oda (Åifre KorumalÄ±)</label>
            </div>
            
            <input type="password" id="room-password-input" placeholder="Oda Åifresi (opsiyonel)" style="display: none;" />
            
            <label for="screen-size">Ekran Boyutu:</label>
            <select id="screen-size">
                <option value="normal">Normal (16m)</option>
                <option value="large" selected>BÃ¼yÃ¼k (24m)</option>
                <option value="xlarge">Ã‡ok BÃ¼yÃ¼k (32m)</option>
                <option value="imax">IMAX (40m)</option>
            </select>
            
            <div class="radio-container">
                <strong>ğŸ® Video KontrolÃ¼:</strong>
                <label>
                    <input type="radio" name="control-mode" value="owner" checked>
                    Sadece oda sahibi kontrol edebilir
                </label>
                <label>
                    <input type="radio" name="control-mode" value="everyone">
                    Herkes kontrol edebilir
                </label>
            </div>
            
            <h2>ğŸ­ BaÅŸlangÄ±Ã§ Sinema OrtamÄ±</h2>
            <div class="info-box">
                â„¹ï¸ Odadayken herkes kendi ortamÄ±nÄ± kendisi iÃ§in deÄŸiÅŸtirebilir.
            </div>
            <div class="environment-grid" id="environment-selector">
                <div class="environment-card selected" data-env="none" onclick="selectEnvironment('none', this)">
                    <div class="environment-icon">â¬›</div>
                    <div class="environment-name">OrtamsÄ±z</div>
                    <div class="environment-desc">Sade karanlÄ±k</div>
                </div>
                <div class="environment-card" data-env="theater" onclick="selectEnvironment('theater', this)">
                    <div class="environment-icon">ğŸª</div>
                    <div class="environment-name">Klasik Sinema</div>
                    <div class="environment-desc">Geleneksel salon</div>
                </div>
                <div class="environment-card" data-env="space" onclick="selectEnvironment('space', this)">
                    <div class="environment-icon">ğŸŒŒ</div>
                    <div class="environment-name">Uzay Ä°stasyonu</div>
                    <div class="environment-desc">YÄ±ldÄ±zlar arasÄ±</div>
                </div>
                <div class="environment-card" data-env="forest" onclick="selectEnvironment('forest', this)">
                    <div class="environment-icon">ğŸŒ²</div>
                    <div class="environment-name">Orman</div>
                    <div class="environment-desc">DoÄŸanÄ±n iÃ§i</div>
                </div>
                <div class="environment-card" data-env="desert" onclick="selectEnvironment('desert', this)">
                    <div class="environment-icon">ğŸœï¸</div>
                    <div class="environment-name">Ã‡Ã¶l Gece</div>
                    <div class="environment-desc">YÄ±ldÄ±zlÄ± gÃ¶kyÃ¼zÃ¼</div>
                </div>
                <div class="environment-card" data-env="moon" onclick="selectEnvironment('moon', this)">
                    <div class="environment-icon">ğŸŒ™</div>
                    <div class="environment-name">Ay YÃ¼zeyi</div>
                    <div class="environment-desc">DÃ¼nya manzarasÄ±</div>
                </div>
                <div class="environment-card" data-env="cyberpunk" onclick="selectEnvironment('cyberpunk', this)">
                    <div class="environment-icon">ğŸŒƒ</div>
                    <div class="environment-name">Cyberpunk</div>
                    <div class="environment-desc">Neon Ä±ÅŸÄ±klar</div>
                </div>
                <div class="environment-card" data-env="underwater" onclick="selectEnvironment('underwater', this)">
                    <div class="environment-icon">ğŸŒŠ</div>
                    <div class="environment-name">Su AltÄ±</div>
                    <div class="environment-desc">Okyanus derinliÄŸi</div>
                </div>
                <div class="environment-card" data-env="mountain" onclick="selectEnvironment('mountain', this)">
                    <div class="environment-icon">â›°ï¸</div>
                    <div class="environment-name">DaÄŸ Zirvesi</div>
                    <div class="environment-desc">Bulutlar Ã¼stÃ¼</div>
                </div>
                <div class="environment-card" data-env="volcano" onclick="selectEnvironment('volcano', this)">
                    <div class="environment-icon">ğŸŒ‹</div>
                    <div class="environment-name">Volkan</div>
                    <div class="environment-desc">AteÅŸ ve lav</div>
                </div>
                <div class="environment-card" data-env="fantasy" onclick="selectEnvironment('fantasy', this)">
                    <div class="environment-icon">âœ¨</div>
                    <div class="environment-name">Fantastik</div>
                    <div class="environment-desc">RÃ¼ya gibi</div>
                </div>
                <div class="environment-card" data-env="city" onclick="selectEnvironment('city', this)">
                    <div class="environment-icon">ğŸ™ï¸</div>
                    <div class="environment-name">Åehir</div>
                    <div class="environment-desc">GÃ¶kdelenler</div>
                </div>
                <div class="environment-card" data-env="beach" onclick="selectEnvironment('beach', this)">
                    <div class="environment-icon">ğŸ–ï¸</div>
                    <div class="environment-name">Sahil</div>
                    <div class="environment-desc">GÃ¼n batÄ±mÄ±</div>
                </div>
            </div>
            
            <br>
            <button onclick="createRoom()">ğŸ¬ Oda OluÅŸtur ve BaÅŸlat</button>
            <button onclick="showMainMenu()" class="secondary">â—€ Geri</button>
        </div>
        
        <!-- Oda Listesi -->
        <div id="room-list" style="display: none;">
            <h2>Aktif Odalar</h2>
            <div id="rooms-container">
                <div class="loading">â³ Odalar yÃ¼kleniyor...</div>
            </div>
            <br>
            <button onclick="refreshRooms()" class="secondary">ğŸ”„ Yenile</button>
            <button onclick="showMainMenu()" class="secondary">â—€ Geri</button>
        </div>
        
        <!-- Åifre GiriÅŸi -->
        <div id="password-prompt" style="display: none;">
            <h2>ğŸ”’ Åifreli Oda</h2>
            <p id="password-room-name"></p>
            <input type="password" id="room-password-join" placeholder="Oda Åifresi" />
            <br><br>
            <button onclick="joinWithPassword()">GiriÅŸ Yap</button>
            <button onclick="showRoomList()" class="secondary">â—€ Geri</button>
        </div>
    </div>
</div>

<!-- Oda Silme Onay ModalÄ± -->
<div id="delete-modal" class="modal">
    <div class="modal-content">
        <h2>ğŸšª Odadan Ã‡Ä±kÄ±ÅŸ</h2>
        <p>Siz bu odanÄ±n sahibisiniz.</p>
        <p><strong>OdayÄ± silmek istiyor musunuz?</strong></p>
        <div class="warning-box">
            âš ï¸ <strong>OdayÄ± silerseniz:</strong> DiÄŸer katÄ±lÄ±mcÄ±lar da otomatik olarak Ã§Ä±karÄ±lÄ±r.<br><br>
            âœ… <strong>AÃ§Ä±k bÄ±rakÄ±rsanÄ±z:</strong> Oda sahipliÄŸi bir sonraki kiÅŸiye devredilir.<br>
            â€¢ Odada baÅŸkalarÄ± varsa â†’ Sahiplik devredilir<br>
            â€¢ Odada kimse yoksa â†’ Oda sahipsiz kalÄ±r, ilk giren sahip olur
        </div>
        <div class="modal-buttons">
            <button onclick="confirmDeleteRoom(false)" class="secondary">HayÄ±r, AÃ§Ä±k BÄ±rak</button>
            <button onclick="confirmDeleteRoom(true)" class="danger">Evet, Sil</button>
        </div>
    </div>
</div>

<!-- Video DeÄŸiÅŸtirme ModalÄ± -->
<div id="change-video-modal" class="modal">
    <div class="modal-content">
        <h2>ğŸ¬ Video DeÄŸiÅŸtir</h2>
        <textarea id="new-video-url" placeholder="Yeni Video URL

YouTube, Google Drive, Catbox, Bunny CDN, HLS streams veya direkt .mp4/.webm/.mov/.ogg linki"></textarea>
        <div class="info-box">
            ğŸ’¡ Video deÄŸiÅŸtirildiÄŸinde tÃ¼m izleyiciler yeni videoyu gÃ¶recektir.
        </div>
        <div class="modal-buttons">
            <button onclick="closeChangeVideoModal()" class="secondary">Ä°ptal</button>
            <button onclick="applyVideoChange()">DeÄŸiÅŸtir</button>
        </div>
    </div>
</div>

<!-- Video Hata Overlay -->
<div id="video-error-overlay">
    <h2>âš ï¸ Video YÃ¼klenemedi</h2>
    <p id="video-error-message"></p>
    <div style="margin-top: 20px;">
        <button onclick="showChangeVideoModal()" style="width: 100%;">ğŸ”„ FarklÄ± Video Dene</button>
        <button onclick="dismissVideoError()" class="secondary" style="width: 100%; margin-top: 10px;">Kapat</button>
    </div>
</div>

<!-- VR Kontrolleri -->
<div id="vr-controls">
    <button onclick="togglePlayPause()">â¯ Play/Pause</button>
    <button onclick="stopVideo()" class="stop">â¹ Durdur</button>
    <button onclick="showChangeVideoModal()">ğŸ¬ Video DeÄŸiÅŸtir</button>
    <button onclick="leaveRoom()">ğŸšª Odadan Ã‡Ä±k</button>
</div>

<!-- Ekran Pozisyon Kontrolleri -->
<div id="screen-controls">
    <div style="text-align: center; color: white; margin-bottom: 10px; font-size: 0.9em;">ğŸ“ Ekran Pozisyonu</div>
    <div class="screen-control-grid">
        <button onclick="moveScreen('up')" title="YukarÄ±">â¬†ï¸</button>
        <button onclick="moveScreen('left')" title="Sola">â¬…ï¸</button>
        <button onclick="moveScreen('right')" title="SaÄŸa">â¡ï¸</button>
        <button onclick="moveScreen('down')" title="AÅŸaÄŸÄ±">â¬‡ï¸</button>
    </div>
    <button onclick="moveScreen('forward')" style="width: 100%; margin: 5px 0;">â« YakÄ±nlaÅŸtÄ±r</button>
    <button onclick="moveScreen('backward')" style="width: 100%; margin: 5px 0;">â¬ UzaklaÅŸtÄ±r</button>
    <button onclick="resetScreenPosition()" style="width: 100%; margin-top: 10px;">ğŸ”„ SÄ±fÄ±rla</button>
</div>

<!-- Chat Konteyneri -->
<div id="chat-container">
    <div id="chat-header">
        ğŸ’¬ Sohbet
        <button onclick="toggleChat()" style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2em;">âœ–</button>
    </div>
    <div id="messages"></div>
    <div id="chat-input-area">
        <input type="text" id="chat-message" placeholder="Mesaj yazÄ±n..." maxlength="200" />
        <button id="send-message-btn" onclick="sendMessage()">ğŸ“¤</button>
    </div>
</div>

<button id="toggle-chat-btn" onclick="toggleChat()">ğŸ’¬</button>

<!-- Ayarlar Paneli -->
<div id="settings-panel">
    <h3>âš™ï¸ KiÅŸisel Ayarlar</h3>
    
    <label>
        ğŸ­ Sinema OrtamÄ±:
        <select id="personal-environment" onchange="changePersonalEnvironment()">
            <option value="none">â¬› OrtamsÄ±z</option>
            <option value="theater">ğŸª Klasik Sinema</option>
            <option value="space">ğŸŒŒ Uzay Ä°stasyonu</option>
            <option value="forest">ğŸŒ² Orman</option>
            <option value="desert">ğŸœï¸ Ã‡Ã¶l Gece</option>
            <option value="moon">ğŸŒ™ Ay YÃ¼zeyi</option>
            <option value="cyberpunk">ğŸŒƒ Cyberpunk</option>
            <option value="underwater">ğŸŒŠ Su AltÄ±</option>
            <option value="mountain">â›°ï¸ DaÄŸ Zirvesi</option>
            <option value="volcano">ğŸŒ‹ Volkan</option>
            <option value="fantasy">âœ¨ Fantastik</option>
            <option value="city">ğŸ™ï¸ Åehir</option>
            <option value="beach">ğŸ–ï¸ Sahil</option>
        </select>
    </label>
    
    <label>
        ğŸ¯ Performans Modu:
        <select id="performance-mode" onchange="changePerformanceMode()">
            <option value="high">YÃ¼ksek Kalite</option>
            <option value="medium" selected>Orta (Ã–nerilen)</option>
            <option value="low">DÃ¼ÅŸÃ¼k (Daha iyi FPS)</option>
        </select>
    </label>
    
    <div style="font-size: 0.8em; color: #aaa; margin-top: 15px;">
        ğŸ’¡ Bu ayarlar sadece sizin iÃ§in geÃ§erlidir.
    </div>
</div>

<button id="settings-toggle-btn" onclick="toggleSettings()">âš™ï¸</button>

<!-- Oda Bilgisi -->
<div id="room-info-display">
    <div><span id="status-indicator" class="status-indicator connected"></span> <span id="room-title">Oda</span></div>
    <div style="font-size: 0.8em; margin-top: 5px;">ğŸ‘¥ <span id="viewers-count">0</span> Ä°zleyici</div>
    <div id="video-service-badge" style="margin-top: 5px;"></div>
    <div id="control-mode-badge" style="margin-top: 5px; font-size: 0.8em;">ğŸ® <span id="control-mode-text">Kontrol</span></div>
    <div id="sync-status">â±ï¸ 3 saniye sonra baÅŸlÄ±yor...</div>
</div>

<!-- VR Sahnesi -->
<a-scene id="vr-scene" loading-screen="enabled: false">
    <!-- Ortam Konteyneri -->
    <a-entity id="environment-container"></a-entity>
    
    <!-- Video EkranÄ± -->
    <a-video
        id="cinema-screen"
        src=""
        width="24"
        height="13.5"
        position="0 2 -15"
        visible="false"
    ></a-video>
    
    <!-- VarsayÄ±lan Zemin -->
    <a-plane 
        id="default-floor"
        position="0 0 0" 
        rotation="-90 0 0" 
        width="100" 
        height="100" 
        color="#1a1a1a"
        visible="true"
    ></a-plane>
    
    <!-- AydÄ±nlatma -->
    <a-light type="ambient" color="#444"></a-light>
    <a-light type="point" position="0 5 0" intensity="0.5"></a-light>
    
    <!-- Spatial Audio iÃ§in Listener -->
    <a-entity id="audio-listener" sound-listener></a-entity>
    
    <!-- VR UI Panel (GeliÅŸmiÅŸ - Hover ile gÃ¶ster/gizle) -->
    <a-entity id="vr-ui-panel" position="0 1.5 -2" visible="false">
        
        <!-- Arka plan panel -->
        <a-plane 
            width="2.5" 
            height="2" 
            color="#1a1a1a" 
            opacity="0.95"
            position="0 0 -0.05">
        </a-plane>
        
        <!-- Play/Pause Butonu -->
        <a-box
            id="vr-play-pause-btn"
            width="0.6" 
            height="0.25"
            depth="0.05"
            position="-0.7 0.7 0"
            color="#667eea"
            class="clickable">
            <a-text value="â–¶ï¸ Play" align="center" position="0 0 0.03" width="1.5" color="#ffffff"></a-text>
        </a-box>
        
        <!-- Durdur Butonu -->
        <a-box
            id="vr-stop-btn"
            width="0.6" 
            height="0.25"
            depth="0.05"
            position="0 0.7 0"
            color="#ff9800"
            class="clickable">
            <a-text value="â¹ Durdur" align="center" position="0 0 0.03" width="1.5" color="#ffffff"></a-text>
        </a-box>
        
        <!-- Video DeÄŸiÅŸtir -->
        <a-box
            id="vr-change-video-btn"
            width="0.6" 
            height="0.25"
            depth="0.05"
            position="0.7 0.7 0"
            color="#f093fb"
            class="clickable">
            <a-text value="ğŸ¬ Video" align="center" position="0 0 0.03" width="1.5" color="#ffffff"></a-text>
        </a-box>
        
        <!-- Seek Bar (Progress) -->
        <a-box
            id="vr-seek-bar-bg"
            width="2.2" 
            height="0.08"
            depth="0.02"
            position="0 0.35 0"
            color="#333333">
        </a-box>
        
        <a-box
            id="vr-seek-bar-progress"
            width="0" 
            height="0.08"
            depth="0.03"
            position="-1.1 0.35 0.01"
            color="#667eea">
        </a-box>
        
        <!-- Zaman gÃ¶stergesi -->
        <a-text
            id="vr-time-display"
            value="00:00 / 00:00"
            position="0 0.15 0"
            align="center"
            width="2.5"
            color="#ffffff">
        </a-text>
        
        <!-- Ekran Pozisyon Kontrolleri -->
        <a-text value="ğŸ“ Ekran" position="0 -0.1 0" align="center" width="2" color="#aaaaaa"></a-text>
        
        <a-box id="vr-screen-up" width="0.25" height="0.25" depth="0.05" position="0 -0.35 0" color="#555555" class="clickable">
            <a-text value="â¬†ï¸" align="center" position="0 0 0.03" width="1.5"></a-text>
        </a-box>
        
        <a-box id="vr-screen-left" width="0.25" height="0.25" depth="0.05" position="-0.3 -0.65 0" color="#555555" class="clickable">
            <a-text value="â¬…ï¸" align="center" position="0 0 0.03" width="1.5"></a-text>
        </a-box>
        
        <a-box id="vr-screen-right" width="0.25" height="0.25" depth="0.05" position="0.3 -0.65 0" color="#555555" class="clickable">
            <a-text value="â¡ï¸" align="center" position="0 0 0.03" width="1.5"></a-text>
        </a-box>
        
        <a-box id="vr-screen-down" width="0.25" height="0.25" depth="0.05" position="0 -0.95 0" color="#555555" class="clickable">
            <a-text value="â¬‡ï¸" align="center" position="0 0 0.03" width="1.5"></a-text>
        </a-box>
        
        <!-- SÄ±fÄ±rla -->
        <a-box id="vr-screen-reset" width="0.6" height="0.2" depth="0.05" position="0.8 -0.65 0" color="#444444" class="clickable">
            <a-text value="ğŸ”„ SÄ±fÄ±rla" align="center" position="0 0 0.03" width="1.2" color="#ffffff"></a-text>
        </a-box>
        
    </a-entity>
    
    <!-- Kamera + Kumandalar -->
    <a-entity id="camera-rig" position="0 1.6 0">
        <a-camera>
            <a-cursor
                id="cursor"
                color="#667eea"
                raycaster="objects: .clickable"
                fuse="true"
                fuse-timeout="1500">
            </a-cursor>
        </a-camera>
    </a-entity>
    
</a-scene>
 
<!-- JavaScript ModÃ¼lleri -->
<script>
const v = new Date().getTime();
document.write('<script src="js/1-config.js?v=' + v + '"><\/script>');
document.write('<script src="js/2-globals.js?v=' + v + '"><\/script>');
document.write('<script src="js/3-environments.js?v=' + v + '"><\/script>');
document.write('<script src="js/4-video-detection.js?v=' + v + '"><\/script>');
document.write('<script src="js/5-ui-functions.js?v=' + v + '"><\/script>');
document.write('<script src="js/6-room-management.js?v=' + v + '"><\/script>');
document.write('<script src="js/7-video-setup.js?v=' + v + '"><\/script>');
document.write('<script src="js/8-video-controls.js?v=' + v + '"><\/script>');
document.write('<script src="js/9-screen-position.js?v=' + v + '"><\/script>');
document.write('<script src="js/10-chat-system.js?v=' + v + '"><\/script>');
document.write('<script src="js/11-settings-panel.js?v=' + v + '"><\/script>');
document.write('<script src="js/12-spatial-audio.js?v=' + v + '"><\/script>');
document.write('<script src="js/13-vr-ui-components.js?v=' + v + '"><\/script>');
document.write('<script src="js/14-vr-ui-updates.js?v=' + v + '"><\/script>');
document.write('<script src="js/15-firebase-sync.js?v=' + v + '"><\/script>');
document.write('<script src="js/17-performance-monitor.js?v=' + v + '"><\/script>');
document.write('<script src="js/18-error-handling.js?v=' + v + '"><\/script>');
document.write('<script src="js/19-debug-tools.js?v=' + v + '"><\/script>');
document.write('<script src="js/20-init.js?v=' + v + '"><\/script>');
</script>

</body>
</html>